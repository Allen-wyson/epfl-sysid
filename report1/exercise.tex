\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{listings}
\usepackage{pdfpages}
\usepackage{amsmath,amssymb}
\usepackage{siunitx}
\usepackage{hyperref}
\usepackage{mhchem}
\usepackage[section]{placeins}
\usepackage[activate, protrusion=true, expansion=true]{microtype}
\usepackage[left=2.5cm, right=2.5cm, bottom=2.5cm, top=2.5cm]{geometry}
\usepackage{libertine}
\usepackage{longtable}

\lstset{backgroundcolor=\color{white},
	frame=L,
	keepspaces=true,
	captionpos=b,
	keywordstyle=\color{blue},
	language=matlab}

\title{System Identification (ME421) at EPFL}
\subtitle{CE-1: Nonparametric Methods}
\author{\textsc{Julia Krottenthaler} \and \textsc{Arne Sachtler}}
\date{\today}

\begin{document}
\maketitle

\section{Step Response}

Figure~\ref{fig:testmodel} shows the modelled system, which will be used for the system identification exercises.
\textcolor{red}{TODO: is this a reasonable choice question}
Figure~\ref{fig:responses} shows the step and impulse response for the system. On the left hand side the noise is included, the right hand side shows the responses without noise.

\begin{figure}[h]
	\centering
	\includegraphics[height=4cm]{figures/systemmodel.png}
	\caption{Simulink model of the test system}\label{fig:testmodel}
\end{figure}


\begin{figure}[h]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/noisy_responses.pdf}
		\subcaption{Noisy responses}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/noisefree.pdf}
		\subcaption{Responses without noise}
	\end{subfigure}
	\caption{Step and impulse responses of the test system with and without noise.}\label{fig:responses}
\end{figure}

\newpage

\section{Auto Correlation of a PRBS signal}

In order to compute the cross-correlation of two discrete-time signals $u(k)$ and $y(k)$, we use 
\begin{equation}
	R_{uy}(h) = \frac{1}{M} \sum\limits_{k=0}^{M-1} u(k)y(k-h)\, .
\end{equation}
We assume two equal-length vectors for the signals $u$ and $y$. Let the length of the input signals be $N$, we choose the following interval for $h$
\begin{equation}
	h \in \{-H, \dots, -1, 0, 1, \dots, H\}\text{ , where } H = \left\lceil \frac{N}{2} \right\rceil \, .
\end{equation}
Using these definitions the cross-correlation can be computed in MATLAB using the code snippet shown in Listing~\ref{lst:corr}.

\begin{lstlisting}[caption={Computing a discrete-time cross correlation of the signal u and y in matlab},label={lst:corr}]
for i = 1:(2*H+1)
    R(i) = sum(u .* circshift(y, -h(i)));
end
\end{lstlisting}

In order to validate our implementation of the cross-correlation function, we used it to compute the autocorrelation two different test signals. 
Figure~\ref{fig:autocorr} shows the autocorrelation function of two different types of signals. 
On the left hand side (Figure~\ref{fig:autocorrPRBS}) there is a PRBS signal (length of the shift register is 4 and number of periods is 2) and its corresponding autocorrelation function. 
In addition, the figure on the right hand side (Figure~\ref{fig:autocorrSINUS}) displays a sinusoidal signal and its autocorrelation function.  

\begin{figure}[h]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/prbs.pdf}
		\subcaption{PRBS signal}
		\label{fig:autocorrPRBS}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/sine.pdf}
		\subcaption{Sinus signal}
		\label{fig:autocorrSINUS}
	\end{subfigure}
	\caption{Two signals and their corresponding autocorrelation function}\label{fig:autocorr}
\end{figure}


\newpage

\section{Impulse response by deconvolution method}

In this excercise the deconvolution method is used in order to calculate the impulse response. 


As an input signal we generate a random signal with the \verb|rand| command (Figure~\ref{fig:inout}).
Since this command returns random numbers in the interval $[0,1]$, we substract $0.5$ so that the random signal does not exceed the saturation values. 

\begin{figure}[h]
	\centering
	\includegraphics[height=5.5cm]{figures/input_output.png}
	\caption{Random input signal and output of the system }
	\label{fig:inout}
\end{figure}


Afterwards we can indentify the dicrete impulse response using the convolution relation:

\begin{equation}
	y(k) = \sum\limits_{j=0}^{k} g(j)y(k-j) \quad k=0,1,2,.. 
\end{equation}

or in a matricial form:
\begin{equation}
	Y = U \Theta.
\end{equation} 


$\Theta$ can then be calculated by 
\begin{equation}
	\Theta = U^{-1} Y.
\end{equation}

As $U$ is an asymmetric Toeplitz maxtrix, $\Theta$ cannot be computed and the obtained result does not show the impulse response (Figure~\ref{fig:originalimpulse}).


In order to fix the numerical problem, we assume $ g(k) = 0 $ for $ k \geq K $ and we obtain $ Y = U_{K} \Theta_{K}$ by removing the last $N-K$ columns of $U$ and the last $N-K$ rows of $\Theta$. 
This equation can be solved in the least squares sense using the pseudo inverse of $U_{K}$

\begin{equation}
	\Theta_{K} = (U^{T}_{K} U_{K})^{-1} U^{T}_{K} Y.
\end{equation}

As the true impuse response is approximately zero after $75 s$, we decided to set $K = 150$. Thus, the obtained impulse response can be seen in Figure~\ref{fig:originalimpulse}. The result is similar to the true impulse response of the signal, which we compute using the \verb|impulse| command in MATLAB.


\begin{figure}[h]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/original_impulse_response.png}
		\subcaption{Original impulse response }
		\label{fig:originalimpulse}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{figures/impulse_response.png}
		\subcaption{Impulse response after removing equations}
		\label{fig:impulseresponse}
	\end{subfigure}
	\caption{Impulse response by deconvolution method with random input signal}\label{fig:deconvolution}
\end{figure}

\end{document}
